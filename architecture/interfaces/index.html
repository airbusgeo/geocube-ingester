<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/airbusgeo/geocube-ingester/architecture/interfaces/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Interfaces - Geocube Ingester</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Interfaces";
        var mkdocs_page_input_path = "architecture/interfaces.md";
        var mkdocs_page_url = "/airbusgeo/geocube-ingester/architecture/interfaces/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Geocube Ingester
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Getting started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../services/">Services</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Interfaces</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#messaging">Messaging</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#pgqueue-implementation">Pgqueue implementation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pubsub-implementation">PubSub implementation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#storage">Storage</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#currently-supported-storages">Currently supported storages</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database">Database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#postgresql-implementation">PostgreSQL implementation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#image-provider">Image Provider</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#current-implementations">Current Implementations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#add-a-new-provider">Add a new provider</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#image-catalog">Image Catalog</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#current-implementations_1">Current implementations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#add-a-new-catalogue">Add a new catalogue</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/prerequisite/">Prerequisite</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/local-install/">Local environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/docker-install/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/k8s-install/">Deploying with Kubernetes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/others/">Customize environment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/tutorials/">Tutorials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/payload/">Payload</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/catalog/">Catalogue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/providers/">Provider</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/graph/">Processing graphs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/monitoring/">Monitoring</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/help/">Getting help</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/development/">Development</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/release-notes/">Release Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Geocube Ingester</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Architecture</li>
      <li class="breadcrumb-item active">Interfaces</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="interfaces">Interfaces</h2>
<p>To integrate into the environment of deployment, the ingester has an interface layer. Some implementations of this layer are available and the user is free to implement others depending on its own environment.</p>
<h3 id="messaging">Messaging</h3>
<p>The messaging interface is available here : <code>vendor/github.com/geocube/interface/messaging/</code>.</p>
<p>It is used to communicate between <code>workflow</code>, <code>downloader</code> and <code>processor</code> service. It is configured in the corresponding <code>main.go</code> in the <code>cmd</code> folder.</p>
<h4 id="pgqueue-implementation">Pgqueue implementation</h4>
<p>A messaging interface based on postgres is implemented using the <a href="https://github.com/btubbs/pgq">btubbs/pgq</a> library: <code>vendor/github.com/geocube/interface/messaging/pgqueue</code>. This implementation has autoscaling capabilities.</p>
<h4 id="pubsub-implementation">PubSub implementation</h4>
<p>Ingester supports PubSub (Google Cloud Platform) messaging broker : <code>vendor/github.com/geocube/interface/messaging/pubsub</code>.</p>
<p>Three topics/subscriptions must be created:</p>
<ul>
<li>To communicate from workflow to downloader service i.e : ingester-downloader</li>
<li>To communicate from workflow to processor service i.e : ingester-processor</li>
<li>To communicate from downloader &amp; processor to workflow i.e : ingester-event</li>
</ul>
<p>NB: Topics &amp; Subscriptions must be created before running Downloader, Processor and Workflow.</p>
<p>A Pub/Sub emulator is available to use PubSub in a local system (with limited capacities).</p>
<p>Please follow the <a href="https://cloud.google.com/pubsub/docs/emulator">documentation</a> to install and start the emulator.</p>
<h3 id="storage">Storage</h3>
<p>The storage is used to download products and to store intermediate images and the final images that are indexed in the Geocube. It must be accessible in reading and writing.</p>
<p>The interface is available in <code>vendor/github.com/geocube/interface/storage</code> package.
Please, refer to the Geocube Installation Guide to implement another interface.</p>
<h4 id="currently-supported-storages">Currently supported storages</h4>
<p>The ingester supports two storage systems: GCS and filesystem.</p>
<h3 id="database">Database</h3>
<p>The database interface is available here : <code>interface/database/db.go</code>.
It is used by the Workflow as a parameter of the service and it is configured in the following file: <code>cmd/workflow/main.go</code>.</p>
<h4 id="postgresql-implementation">PostgreSQL implementation</h4>
<p>Ingester currently supports a Postgresql database : <code>interface/database/pg/</code>
Create a database and run the installation SQL script in order to create all tables, schemas and roles.
This script is available in Geocube code source in <code>interface/database/pg/db.sql</code></p>
<pre><code class="language-bash">$ psql -h &lt;database_host&gt; -d &lt;database_name&gt; -f interface/database/pg/db.sql
</code></pre>
<h3 id="image-provider">Image Provider</h3>
<p>To download images from data-storages, the ingester has the current interface:
<code>interface/provider/provider.go</code>. It is used by the Downloader service and configured in <code>cmd/downloader/main.go</code>.</p>
<h4 id="current-implementations">Current Implementations</h4>
<p>The Downloader service is currently able to download Sentinel 1 &amp; 2 products from:</p>
<ul>
<li>Peps</li>
<li>Copernicus (wip)</li>
<li>Onda</li>
<li>Creodias</li>
<li>Mundi</li>
<li>Local file system</li>
<li>GCS</li>
<li>Alaska Satellite Facility</li>
</ul>
<p>Depending on the provider, the user may need credentials. Please refer to the API documentation of the provider.</p>
<h4 id="add-a-new-provider">Add a new provider</h4>
<ol>
<li>Add configuration parameters (credentials, endpoint) in <code>cmd/downloader/main.go</code> and add the new provider to the list of providers.</li>
<li>Implement the new provider in <code>ìnterface/provider</code> with methods:</li>
</ol>
<pre><code class="language-go">Name() string
Download(ctx context.Context, scene common.Scene, localDir string) error
</code></pre>
<h3 id="image-catalog">Image Catalog</h3>
<p>To be able to list the scenes available over an AOI, the Ingester has an interface to an external catalogue service : <code>interface/catalog/catalog.go</code></p>
<h4 id="current-implementations_1">Current implementations</h4>
<p>The Ingester is currently able to connect to the following catalogues:</p>
<ul>
<li>Copernicus for sentinel1 &amp; 2 scenes</li>
<li>GCS for bursts annotations of an archive stored in GCS</li>
</ul>
<div id="custom-interface"></div>
<h4 id="add-a-new-catalogue">Add a new catalogue</h4>
<p>In order to add a new catalogue:</p>
<ol>
<li>For a new constellation/satellite: in file <code>catalog/catalog.go</code>, adapt <code>DoTilesInventory</code> method in order to be able to interpret the new constellation (otherwise no update needed).</li>
<li>In file <code>catalog/scenes.go</code>, add newProvider instantiation in <code>ScenesInventory</code> method.</li>
<li>For a new constellation/satellite: in file <code>catalog/entities/entities.go</code> add the constellation name and adapt <code>GetConstellation</code> method in order to manage the new constellation (otherwise no update needed).</li>
<li>Add configuration parameters (credentials, endpoint) in <code>cmd/catalog/main.go</code>.</li>
<li>Implement new catalog in <code>interface/catalog</code> with method:</li>
</ol>
<pre><code class="language-go">SearchScenes(ctx context.Context, area *entities.AreaToIngest, aoi geos.Geometry) ([]*entities.Scene, error)
</code></pre>
<p>This method returns a list of available scenes</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../services/" class="btn btn-neutral float-left" title="Services"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../installation/prerequisite/" class="btn btn-neutral float-right" title="Prerequisite">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../services/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../installation/prerequisite/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
