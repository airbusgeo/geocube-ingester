<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/airbusgeo/geocube-ingester/architecture/services/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Services - Geocube Ingester</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Services";
        var mkdocs_page_input_path = "architecture/services.md";
        var mkdocs_page_url = "/airbusgeo/geocube-ingester/architecture/services/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Geocube Ingester
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Getting started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Services</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#process">Process</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#catalogue-service">Catalogue service</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#workflow-service">Workflow service</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#downloader-service">Downloader service</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#processor-service">Processor service</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/prerequisite/">Prerequisite</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/local-install/">Local environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/docker-install/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/k8s-install/">Deploying with Kubernetes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/others/">Customize environment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/tutorials/">Tutorials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/payload/">Payload</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/graph/">Processing graphs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/run/">Run a payload</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/monitoring/">Monitoring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/catalog/">Catalogue service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/providers/">Provider</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guide/interfaces/">Interfaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guide/sensors/">Sensor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guide/catalog/">Catalogue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-guide/providers/">Provider</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/help/">Getting help</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/development/">Development</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/release-notes/">Release Notes</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Geocube Ingester</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Architecture</li>
      <li class="breadcrumb-item active">Services</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="process-and-services">Process and services</h2>
<p>The Geocube Ingester is an example of a complete and parallelizable service to feed the Geocube. The user posts an AOI, a time interval and a set of parameters (to compute the output layers). The ingester takes care of everything from the downloading of the products, the computing and its parallelization and the ingestion in the Geocube.</p>
<p>It is composed of three services : workflow, downloader and processor. It is connected to a Geocube and has a couple of interfaces to integrate in the user environment. Some implementations of the interfaces are available and the user is free to implement others according to its environment.</p>
<p><img alt="Ingester Architecture" src="../IngesterArchitecture.png" /></p>
<h3 id="process">Process</h3>
<p>The ingestion is a process in five steps:</p>
<ol>
<li>List the products fitting the criteria</li>
<li>Split them in tiles (optional)</li>
<li>Create a working graph, with downloading and processing tasks</li>
<li>Download the product</li>
<li>Process, store and index them in the Geocube</li>
</ol>
<p><img alt="Ingester Workflow" src="../IngesterWorkflow.png" /></p>
<h3 id="catalogue-service">Catalogue service</h3>
<p>The first two steps are done by a service called <code>Catalogue</code>. The goal of the first step is to find all the satellite products (<code>scenes</code>) that fit the criterias, sort them by date and group them by localisation. </p>
<p>When it's relevant for preprocessing or ingestion, the <code>scenes</code> can be divided into <code>tiles</code> (e.g. S1 images can be split in bursts). This second step is not mandatory.</p>
<p>If it's necessary, for example to coregistrate products with the <code>previous</code> one or from a <code>reference</code>, a working graph is created where each <code>tile</code> has an ancestor (the previous product at the same location) and a reference (the first product of the timeserie at the same location). Nevertheless, this working graph can only be executed when the <code>tiles</code> are on the same grid (e.g. granules for S2, bursts for S1... ), hence the interest to use a common grid to divide the scenes into tiles.</p>
<p>The <code>catalogue</code> service is usually managed by the <code>workflow service</code>, but it can be standalone.</p>
<p>The <code>catalogue</code> service is connected to a Geocube to get, check or record some information to prepare the indexation.</p>
<h3 id="workflow-service">Workflow service</h3>
<p>The <code>workflow service</code> is responsible for the orchestration of the downloading and processing tasks. It is connected to a database that contains all the current and past tasks. </p>
<p>Each task has :</p>
<ul>
<li>An ID and a name</li>
<li>A status (NEW, PENDING, DONE, RETRY, FAILED)</li>
<li>A message (that is especially used to report errors)</li>
<li>(Processing tasks only): a reference and a previous Task</li>
</ul>
<p>A processing task is sent to the processing service as soon as its reference and previous tasks are either null, DONE or FAILED.</p>
<p>The downloading or processing orders are emitted automatically to the corresponding service through a messaging service.</p>
<p>As downloading a product and processing it are two tasks that have not the same requirements in term of CPU, memory, bandwidth, they are executed by two different services.</p>
<h3 id="downloader-service">Downloader service</h3>
<p>The <code>downloader service</code>:</p>
<ul>
<li>has connections to several external providers of images</li>
<li>has appropriate rights to store images in a local or near storage.</li>
<li>
<p>pulls downloading tasks from the messaging service and process them :</p>
<ol>
<li>Download the scenes from several <a href="../../user-guide/providers/">providers</a>. When a list of providers is available, the downloader tries them one by one until the product is found. </li>
<li>Split the scenes in tiles (if necessary) according to a <a href="../../user-guide/graph/">processing graph</a>.</li>
<li>Upload the tiles on a local or near storage.</li>
</ol>
</li>
<li>
<p>sent the result (success or failure) to the workflow service through a messaging service.</p>
</li>
</ul>
<h3 id="processor-service">Processor service</h3>
<p>The <code>processor service</code>:</p>
<ul>
<li>is connected to the Geocube Server (to index the layers processed)</li>
<li>has appropriate rights to read images from the local or near storage (the one where the products are downloader)</li>
<li>has appropriate rights to write images on a store reachable by the Geocube Server.</li>
<li>
<p>pulls processing tasks from the messaging service and processes them:</p>
<ol>
<li>Get the tiles from the local storage and process them to as many layers as required, according to a <a href="../../user-guide/graph/">processing graph</a>.</li>
<li>Upload the output layers to a storage accessible by the Geocube</li>
<li>Index the output layers in the Geocube</li>
<li>Clean the temporary files that are stored in the local or near storage</li>
</ol>
</li>
<li>
<p>sent the result (success or failure) to the workflow service through a messaging service.</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../quickstart/" class="btn btn-neutral float-left" title="Getting started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../installation/prerequisite/" class="btn btn-neutral float-right" title="Prerequisite">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../installation/prerequisite/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
